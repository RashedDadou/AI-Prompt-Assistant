<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§  AI Prompt Assistant Pro - Final Version</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0d1117; color: #c9d1d9; margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: auto; }
        h1 { text-align: center; color: #58a6ff; }
        textarea, input, button { font-size: 16px; }
        #promptInput { width: 100%; height: 120px; padding: 15px; background: #161b22; color: #c9d1d9; border: 1px solid #30363d; border-radius: 8px; }
        #livePreview { margin: 15px 0; padding: 15px; background: #161b22; border-radius: 8px; border-left: 4px solid #58a6ff; }
        #suggestions { margin: 15px 0; }
        .suggestion { padding: 10px; background: #21262d; margin: 8px 0; border-radius: 6px; }
        button { padding: 12px 24px; margin: 8px; background: #238636; color: white; border: none; border-radius: 6px; cursor: pointer; }
        button:hover { background: #2ea043; }
        #generateBtn { background: #1f6feb; }
        #generateBtn:hover { background: #388bfd; }
        #copyBtn { background: #6f42c1; }
        #output { margin: 20px 0; padding: 20px; background: #161b22; border-radius: 8px; white-space: pre-wrap; font-size: 17px; }
        #history, #imageAnalysis { margin-top: 40px; }
        .history-item { background: #161b22; padding: 15px; margin: 10px 0; border-radius: 8px; border: 1px solid #30363d; }
        #imageUpload { margin: 20px 0; }
        #generatedImage { max-width: 100%; margin: 20px 0; border-radius: 10px; border: 2px solid #58a6ff; }
        .footer { text-align: center; margin-top: 60px; color: #8b949e; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§  AI Prompt Assistant Pro - Final</h1>
        <p style="text-align: center;">Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù€ Prompts + ØªØ­Ù„ÙŠÙ„ ØµÙˆØ± + ØªØ§Ø±ÙŠØ® + ØªÙˆÙ„ÙŠØ¯</p>

        <textarea id="promptInput" placeholder="Ø§ÙƒØªØ¨ ÙˆØµÙÙƒ Ù‡Ù†Ø§... Ù…Ø«Ø§Ù„: helicopter landing in desert at sunset"></textarea>

        <div id="suggestions"></div>
        <div id="livePreview"><strong>Ù…Ø¹Ø§ÙŠÙ†Ø© Ø­ÙŠØ©:</strong><br><span id="previewText"></span></div>

        <div style="text-align: center;">
            <button id="generateBtn">ğŸš€ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù€ Prompt Ø§Ù„Ù…Ø­Ø³Ù†</button>
            <button id="copyBtn">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
            <button id="generateImageBtn">ğŸ¨ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ±Ø© (SD WebUI)</button>
        </div>

        <div id="output"></div>

        <!-- ØªØ­Ù…ÙŠÙ„ ÙˆØªØ­Ù„ÙŠÙ„ ØµÙˆØ±Ø© -->
        <div id="imageAnalysis">
            <h2>ğŸ“¸ ØªØ­Ù…ÙŠÙ„ ÙˆØªØ­Ù„ÙŠÙ„ ØµÙˆØ±Ø© Ù…ÙˆÙ„Ø¯Ø©</h2>
            <input type="file" id="imageUpload" accept="image/*">
            <button id="analyzeBtn">ğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©</button>
            <div id="analysisResult"></div>
            <img id="uploadedImage" style="display:none;">
        </div>

        <!-- Ø¹Ø±Ø¶ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ù† SQLite -->
        <div id="history">
            <h2>ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ù€ Prompts ÙˆØ§Ù„ØµÙˆØ±</h2>
            <button id="loadHistoryBtn">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„</button>
            <div id="historyList">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        </div>

        <div class="footer">Made with ğŸ”¥ by Rashed Dadou & Grok | 2026</div>
    </div>

    <script>
        // ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Python backend Ø¹Ø¨Ø± Flask API (Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ localhost:5000)
        const API_URL = "http://127.0.0.1:5000";

        const input = document.getElementById('promptInput');
        const previewText = document.getElementById('previewText');
        const suggestionsDiv = document.getElementById('suggestions');
        const output = document.getElementById('output');
        const generateBtn = document.getElementById('generateBtn');
        const copyBtn = document.getElementById('copyBtn');
        const generateImageBtn = document.getElementById('generateImageBtn');
        const imageUpload = document.getElementById('imageUpload');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const analysisResult = document.getElementById('analysisResult');
        const uploadedImage = document.getElementById('uploadedImage');
        const loadHistoryBtn = document.getElementById('loadHistoryBtn');
        const historyList = document.getElementById('historyList');

        // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø­ÙŠØ© (Ù…Ø­Ù„ÙŠØ© Ø¨Ø³ÙŠØ·Ø©)
        input.addEventListener('input', async () => {
            const prompt = input.value.trim();
            if (!prompt) {
                previewText.textContent = '';
                suggestionsDiv.innerHTML = '';
                return;
            }

            try {
                const res = await fetch(`${API_URL}/preview`, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({prompt})
                });
                const data = await res.json();
                previewText.textContent = data.enhanced_prompt || prompt;
                suggestionsDiv.innerHTML = data.display_suggestions.length ? 
                    "<strong>Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª:</strong><br>" + 
                    data.display_suggestions.map(s => `<div class="suggestion">âœ” ${s}</div>`).join('') : '';
            } catch (e) {
                previewText.textContent = prompt;
            }
        });

        // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù€ Prompt Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        generateBtn.addEventListener('click', async () => {
            const prompt = input.value.trim();
            if (!prompt) return;

            try {
                const res = await fetch(`${API_URL}/enhance`, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({prompt})
                });
                const data = await res.json();
                output.innerHTML = `<strong>Ø§Ù„Ù€ Prompt Ø§Ù„Ù…Ø­Ø³Ù†:</strong><br><br>${data.enhanced_prompt}`;
            } catch (e) {
                output.innerHTML = "<strong>Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù€ Backend</strong>";
            }
        });

        // Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø©
        copyBtn.addEventListener('click', () => {
            const text = output.textContent || previewText.textContent || input.value;
            navigator.clipboard.writeText(text.replace(/Ø§Ù„Ù€ Prompt Ø§Ù„Ù…Ø­Ø³Ù†:|\n/g, '').trim());
            copyBtn.textContent = "âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®!";
            setTimeout(() => copyBtn.textContent = "ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø©", 2000);
        });

        // ØªÙˆÙ„ÙŠØ¯ ØµÙˆØ±Ø© Ø¹Ø¨Ø± Stable Diffusion WebUI
        generateImageBtn.addEventListener('click', async () => {
            const prompt = previewText.textContent || input.value;
            if (!prompt) return;

            try {
                generateImageBtn.disabled = true;
                generateImageBtn.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆÙ„ÙŠØ¯...";
                const res = await fetch(`${API_URL}/generate_image`, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({prompt})
                });
                const data = await res.json();
                if (data.image_url) {
                    const img = document.createElement('img');
                    img.src = data.image_url;
                    img.style.maxWidth = "100%";
                    img.id = "generatedImage";
                    output.appendChild(img);
                }
                analysisResult.innerHTML = `<strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªÙˆÙ„ÙŠØ¯:</strong> ${data.notes || "ØªÙ… Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­"}`;
            } catch (e) {
                analysisResult.innerHTML = "Ø®Ø·Ø£ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ±Ø©";
            } finally {
                generateImageBtn.disabled = false;
                generateImageBtn.textContent = "ğŸ¨ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØ±Ø©";
            }
        });

        // ØªØ­Ù…ÙŠÙ„ ÙˆØªØ­Ù„ÙŠÙ„ ØµÙˆØ±Ø©
        imageUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    uploadedImage.src = ev.target.result;
                    uploadedImage.style.display = "block";
                };
                reader.readAsDataURL(file);
            }
        });

        analyzeBtn.addEventListener('click', async () => {
            const file = imageUpload.files[0];
            if (!file) {
                analysisResult.innerHTML = "Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹";
                return;
            }

            const formData = new FormData();
            formData.append("image", file);

            try {
                const res = await fetch(`${API_URL}/analyze_image`, {
                    method: "POST",
                    body: formData
                });
                const data = await res.json();
                analysisResult.innerHTML = `<strong>ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©:</strong><br>${data.notes}`;
            } catch (e) {
                analysisResult.innerHTML = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„";
            }
        });

        // Ø¹Ø±Ø¶ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù…Ù† SQLite
        loadHistoryBtn.addEventListener('click', async () => {
            try {
                const res = await fetch(`${API_URL}/history`);
                const history = await res.json();
                if (history.length === 0) {
                    historyList.innerHTML = "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ø¨Ø¹Ø¯</p>";
                    return;
                }
                historyList.innerHTML = history.map(item => `
                    <div class="history-item">
                        <strong>Prompt:</strong> ${item.prompt}<br>
                        <strong>Enhanced:</strong> ${item.enhanced_prompt}<br>
                        <strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${item.timestamp}<br>
                        <strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${item.notes || "Ù„Ø§ ÙŠÙˆØ¬Ø¯"}
                        ${item.image_path ? `<br><img src="${item.image_path}" style="max-width:100%; margin-top:10px; border-radius:8px;">` : ''}
                    </div>
                `).join('');
            } catch (e) {
                historyList.innerHTML = "Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„";
            }
        });

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
        loadHistoryBtn.click();
    </script>
</body>
</html>